@using SMSClient.Models.ViewModel;
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}


@using (Html.BeginForm("Create", "Courses", FormMethod.Post)) {


    @(Html.DevExtreme().Form<Course>()
                .Items(items =>
                {
                    items.AddGroup()
                        .ColCount(2)
                        .Items(groupItems =>
                        {
                            groupItems.AddSimpleFor(m => m.CourseCode)
                                .Editor(e => e.TextBox());

                            groupItems.AddSimpleFor(m => m.ShortName)
                                .Editor(e => e.TextBox());

                            groupItems.AddSimpleFor(m => m.LongName)
                                .Editor(e => e.TextBox());
                        });

                    items.AddButton()
                        .ButtonOptions(button => button.Text("Add Course")
                                                        .UseSubmitBehavior(true));
                })
    )
    
}

@using (Html.BeginForm("AddCourseToSemester", "Courses", FormMethod.Post)) {

    @(
    Html.DevExtreme().Form<CourseSemesterViewModel>()
                        .Items(items =>
                                 {
                                     items.AddGroup()
                                      .ColCount(3)
                                      .Items(groupItems =>
                                      {
                                          groupItems.AddSimpleFor(m => m.DepartmentId)
                                              .Editor(e => e.SelectBox().DataSource(d => d.Mvc().LoadAction("GetDepartments")).DisplayExpr("LongName").ValueExpr("Id").OnValueChanged("onDepartmentChange")
                                              .ID("departmentBox"));

                                          groupItems.AddSimpleFor(m => m.SemesterId)
                                            .Editor(e => e.SelectBox()
                                            .DataSource(d => d.Mvc().LoadAction("GetSemesters").LoadParams(new { department = new JS("function() {return department;}") }))
                                            .ID("semesterBox")
                                            .DisplayExpr("LongName")
                                            .ValueExpr("Id")
                                            .OnValueChanged("onSemesterChange"));

                                          groupItems.AddSimpleFor(m => m.CourseIds)
                                              .Editor(e => e.TagBox()
                                              .DataSource(d => d.Mvc().LoadAction("GetRemainingCourses").LoadParams(new {department = new JS("function() {return department;}"), semester = new JS("function() {return semester;}") }))
                                              .ID("courseBox")
                                              .DisplayExpr("CourseCode")
                                              .ValueExpr("CourseCode")
                                              .ID("courseBox"));
                                      });

                                         items.AddButton()
                                                    .ButtonOptions(button => button.Text("Add Course")
                                                    .UseSubmitBehavior(true));
                        })
    )
}


<script>
    let department, semester;
    function onDepartmentChange() {
        department = $("#departmentBox").dxSelectBox("instance").option("value");
        $("#courseBox").dxTagBox("instance").reset();
        $("#semesterBox").dxSelectBox("instance").reset();
        $("#semesterBox").dxSelectBox("instance").getDataSource().reload();
        $("#courseBox").dxTagBox("instance").getDataSource().reload();
    }
    function onSemesterChange() {
        semester = $("#semesterBox").dxSelectBox("instance").option("value");
        $("#courseBox").dxTagBox("instance").getDataSource().reload();
        $("#courseBox").dxTagBox("instance").reset();
    }
</script>


@*
@(Html.DevExtreme().SelectBox()
    .DataSource(d => d.Mvc().LoadAction("GetDepartments")).DisplayExpr("LongName").ValueExpr("Id").OnValueChanged("onDepartmentChange")
    .ID("departmentBox"))
@(Html.DevExtreme().SelectBox()
    .DataSource(d => d.Mvc().LoadAction("GetSemesters").LoadParams(new { department = new JS("function() {return department;}") }))
    .ID("semesterBox")
    .DisplayExpr("LongName")
    .ValueExpr("Id")
    .OnValueChanged("onSemesterChange")
)
@Html.DevExtreme().List().DataSource(d => d.Mvc().LoadAction("GetCourses").LoadParams(new { department = new JS("function() {return department;}"), semester = new JS("function() {return semester;}") })).ID("courseList")

<script>
    let department, semester;
    function onDepartmentChange() {
        department = $("#departmentBox").dxSelectBox("instance").option("value");
        $("#semesterBox").dxSelectBox("instance").getDataSource().reload();
        $("#semesterBox").dxSelectBox("instance").reset();
    }
    function onSemesterChange() {
        semester = $("#semesterBox").dxSelectBox("instance").option("value");
        $("#courseList").dxList("instance").getDataSource().reload();
        // $("#courseList").dxSelectBox("instance").reset();
    }
</script>
*@